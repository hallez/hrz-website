---
resources:
- name: website-develop
  type: git
  source:
    uri: git@github.com:hallez/hrz-website
    branch: develop
    private_key: {{private-key}}

- name: website-master
  type: git
  source:
    uri: git@github.com:hallez/hrz-website
    branch: master
    private_key: {{private-key}}

- name: slack_alert
  type: slack-notification
  source:
    url: {{slack-url}}

jobs:
- name: build-deploy-site-develop
  public: false
  serial: true
  plan:
  - get: website
    resource: website-develop
    trigger: true
  - task: build-deploy-site-develop
    file: website/scripts/ci/build_deploy_site.yml
    config:
      params:
        CF_USER: {{cf-user}}
        CF_PASSWORD: {{cf-password}}
        CF_ORG: {{cf-org-develop}}
        CF_SPACE: {{cf-space-develop}}
        CF_APPLICATION: {{cf-application-develop}}
        STATIC_FILE_AUTH: {{static-file-auth-develop}}
    on_success:
      put: slack_alert
      params:
        username: concourse
        icon_url: http://cl.ly/image/3e1h0H3H2s0P/concourse-logo.png
        channel: {{slack-channel}}
        text: {{slack-develop-success-text}}
    on_failure:
      put: slack_alert
      params:
        username: concourse
        icon_url: http://cl.ly/image/3e1h0H3H2s0P/concourse-logo.png
        channel: {{slack-channel}}
        text: {{slack-develop-failure-text}}

- name: build-deploy-site-master
  public: false
  serial: true
  plan:
  - get: website
    resource: website-develop
    passed: [build-deploy-site-develop]
    trigger: true
  - task: build-deploy-site-master
    file: website/scripts/ci/build_deploy_site.yml
    config:
      params:
        CF_USER: {{cf-user}}
        CF_PASSWORD: {{cf-password}}
        CF_ORG: {{cf-org-master}}
        CF_SPACE: {{cf-space-master}}
        CF_APPLICATION: {{cf-application-master}}
    on_success:
      put: slack_alert
      params:
        username: concourse
        icon_url: http://cl.ly/image/3e1h0H3H2s0P/concourse-logo.png
        channel: {{slack-channel}}
        text: {{slack-master-success-text}}
    on_failure:
      put: slack_alert
      params:
        username: concourse
        icon_url: http://cl.ly/image/3e1h0H3H2s0P/concourse-logo.png
        channel: {{slack-channel}}
        text: {{slack-master-failure-text}}
  - put: website-master
    params:
      repository: website
